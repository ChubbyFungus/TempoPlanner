%% src/components/floorplanner/Canvas.tsx:400-450
sequenceDiagram
    participant U as User
    participant T as Toolbar
    participant H as Home
    participant C as Canvas
    participant S as SnapSystem
    participant G as Grid
    participant D as Display

    Note over U,T: Tool Activation Phase
    U->>T: Click Measure Tool
    T->>H: setDrawingMode("measure")
    H->>C: updateCursor("crosshair")
    H->>C: enableSnapGuides()

    Note over U,C: Start Point Selection
    U->>C: Click start point
    C->>S: snapToNearestPoint(mousePos)
    S->>G: checkGridSnap(20px threshold)
    S->>C: checkWallSnap(10px threshold)
    S->>C: checkCornerSnap(15px threshold)
    C->>H: setMeasureStart(snappedPoint)
    H->>D: showStartIndicator()

    Note over U,C: Measurement Preview
    U->>C: Move mouse
    C->>S: snapToNearestPoint(currentPos)
    C->>H: updateMeasureLine(start, current)
    C->>H: calculateDistance(start, current)
    H->>G: convertPixelsToFeet(distance)
    H->>D: showMeasurement({
        distance,
        angle,
        units: "ft-in"
    })
    H->>D: updateGuideLines()

    Note over U,H: Measurement Completion
    U->>C: Click end point
    C->>S: snapToNearestPoint(endPos)
    C->>H: finalizeMeasurement({
        startPoint,
        endPoint,
        distance,
        angle
    })
    H->>H: addToHistory()
    H->>D: showFinalMeasurement()