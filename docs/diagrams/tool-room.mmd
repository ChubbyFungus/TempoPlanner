%% src/components/floorplanner/tools/RoomTool.tsx
sequenceDiagram
    participant U as User
    participant T as Toolbar
    participant H as Home
    participant C as Canvas
    participant R as RoomManager
    participant V as Validator
    participant S as SnapSystem

    Note over U,T: Room Tool Initialization
    U->>T: Select Room Tool
    T->>H: setActiveTool("room")
    H->>C: enableRoomPreview()
    H->>S: setSnapTargets([
        "corners",
        "walls",
        "grid"
    ])

    Note over U,R: Room Point Collection
    loop Add Points
        U->>C: Click point
        C->>S: snapPoint(position)
        C->>R: addPoint({
            x: snappedX,
            y: snappedY,
            type: "corner"
        })
        R->>C: drawPreviewLine()
        R->>C: showPointIndicator()
        
        alt point count >= 3
            R->>C: enableClosePath()
            C->>C: showCloseIndicator()
        end
    end

    Note over U,V: Room Validation
    U->>C: Double click/Close path
    C->>V: validateRoom({
        minPoints: 3,
        minArea: 20,
        selfIntersecting: false
    })
    V-->>R: validationResult

    Note over R,H: Room Finalization
    alt valid room
        R->>R: calculateArea()
        R->>R: determineRoomType()
        R->>R: createWalls()
        R->>R: assignLayer()
        R->>H: updateCanvas()
        H->>H: addToHistory()
    else invalid room
        R->>H: showError("Invalid room shape")
        R->>R: resetTool()
    end